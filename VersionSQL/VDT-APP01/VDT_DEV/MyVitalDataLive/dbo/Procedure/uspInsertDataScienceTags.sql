/****** Object:  Procedure [dbo].[uspInsertDataScienceTags]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE PROCEDURE [dbo].[uspInsertDataScienceTags]
AS

/*
--08/28/2020		Sunil Nokku			SP to Import DataScience tables from 135 to 134.
--EXEC uspInsertDataScienceTags
--09/30/2020		Sunil Nokku			Add new column Model_Used #TFS 3744
*/
BEGIN

SET NOCOUNT ON;

	DROP INDEX IX_PartyKey ON dbo.tags_for_high_risk_members

	TRUNCATE TABLE dbo.tags_for_high_risk_members

	INSERT INTO dbo.tags_for_high_risk_members(
		PartyKey,
		Prediction_Date,
		Is_Top10pct_predicted,
		Top_k_pct_predicted,
		Is_recurring,
		Is_SUD3_predicted,
		Is_Ortho3_predicted,
		Is_Renal3_predicted,
		Is_Depress3_predicted,
		Med_PaidAmt_Prev360d,
		RX_PaidAmt_Prev360d,
		Is_Top10pct_Prev360d,
		SDOH_Vulnerable_OverAll,
		SDOH_Vulnerable_Socioeconomic,
		SDOH_Vulnerable_HH_ComposiitonDisability,
		SDOH_Vulnerable_Language,
		SDOH_Vulnerable_Transportation,
		Avg_MME_per_DayOnMME_Prev360d,
		Max_MME_per_DayOnMME_Prev360d,
		Total_MME_Prev360d,
		Family_Size,
		Has_Depressed_Family_Members_in_History,
		Is_Depressed_in_History,
		Has_Obesity_History,
		Latest_Obesity_Dx_in_History,
		Latest_Rx_Fill,
		Latest_Visit_to_Provider,
		Has_Visit_to_Provider_in_Prev120d,
		Latest_Visit_to_ED,
		Count_EDvisits_in_Prev120d,
		GapInCare_CDC_ha1c,
		GapInCare_mammogram,
		GapInCare_MedExam,
		Has_DiabetesMellitus_past720d,
		Count_Dist_Chronic_ICD10dx_in_history,
		Count_Dist_Chronic_CCS_in_history,
		Count_Dist_Chronic_BodySystem_in_history,
		ElixGrp_AA_in_history,
		ElixGrp_BLA_in_history,
		ElixGrp_CA_in_history,
		ElixGrp_CHF_in_history,
		ElixGrp_Coag_in_history,
		ElixGrp_COPD_in_history,
		ElixGrp_DA_in_history,
		ElixGrp_DC_in_history,
		ElixGrp_Depres_in_history,
		ElixGrp_DrgAbuse_in_history,
		ElixGrp_DUC_in_history,
		ElixGrp_FED_in_history,
		ElixGrp_HC_in_history,
		ElixGrp_HIV_in_history,
		ElixGrp_HUC_in_history,
		ElixGrp_Hy_in_history,
		ElixGrp_LD_in_history,
		ElixGrp_Ly_in_history,
		ElixGrp_MC_in_history,
		ElixGrp_OBS_in_history,
		ElixGrp_OND_in_history,
		ElixGrp_Paralysis_in_history,
		ElixGrp_PCD_in_history,
		ElixGrp_Psycs_in_history,
		ElixGrp_PUDExB_in_history,
		ElixGrp_PVD_in_history,
		ElixGrp_RA_in_history,
		ElixGrp_RF_in_history,
		ElixGrp_STM_in_history,
		ElixGrp_VD_in_history,
		ElixGrp_WgtLoss_in_history,
		Has_Chronic_SUD_in_history
	)
	SELECT
		PartyKey,
		Prediction_Date,
		Is_Top10pct_predicted,
		Top_k_pct_predicted,
		Is_recurring,
		Is_SUD3_predicted,
		Is_Ortho3_predicted,
		Is_Renal3_predicted,
		Is_Depress3_predicted,
		Med_PaidAmt_Prev360d,
		RX_PaidAmt_Prev360d,
		Is_Top10pct_Prev360d,
		SDOH_Vulnerable_OverAll,
		SDOH_Vulnerable_Socioeconomic,
		SDOH_Vulnerable_HH_ComposiitonDisability,
		SDOH_Vulnerable_Language,
		SDOH_Vulnerable_Transportation,
		Avg_MME_per_DayOnMME_Prev360d,
		Max_MME_per_DayOnMME_Prev360d,
		Total_MME_Prev360d,
		Family_Size,
		Has_Depressed_Family_Members_in_History,
		Is_Depressed_in_History,
		Has_Obesity_History,
		Latest_Obesity_Dx_in_History,
		Latest_Rx_Fill,
		Latest_Visit_to_Provider,
		Has_Visit_to_Provider_in_Prev120d,
		Latest_Visit_to_ED,
		Count_EDvisits_in_Prev120d,
		GapInCare_CDC_ha1c,
		GapInCare_mammogram,
		GapInCare_MedExam,
		Has_DiabetesMellitus_past720d,
		Count_Dist_Chronic_ICD10dx_in_history,
		Count_Dist_Chronic_CCS_in_history,
		Count_Dist_Chronic_BodySystem_in_history,
		ElixGrp_AA_in_history,
		ElixGrp_BLA_in_history,
		ElixGrp_CA_in_history,
		ElixGrp_CHF_in_history,
		ElixGrp_Coag_in_history,
		ElixGrp_COPD_in_history,
		ElixGrp_DA_in_history,
		ElixGrp_DC_in_history,
		ElixGrp_Depres_in_history,
		ElixGrp_DrgAbuse_in_history,
		ElixGrp_DUC_in_history,
		ElixGrp_FED_in_history,
		ElixGrp_HC_in_history,
		ElixGrp_HIV_in_history,
		ElixGrp_HUC_in_history,
		ElixGrp_Hy_in_history,
		ElixGrp_LD_in_history,
		ElixGrp_Ly_in_history,
		ElixGrp_MC_in_history,
		ElixGrp_OBS_in_history,
		ElixGrp_OND_in_history,
		ElixGrp_Paralysis_in_history,
		ElixGrp_PCD_in_history,
		ElixGrp_Psycs_in_history,
		ElixGrp_PUDExB_in_history,
		ElixGrp_PVD_in_history,
		ElixGrp_RA_in_history,
		ElixGrp_RF_in_history,
		ElixGrp_STM_in_history,
		ElixGrp_VD_in_history,
		ElixGrp_WgtLoss_in_history,
		Has_Chronic_SUD_in_history
	FROM [VD-RPT02].Datalogy.ds.tags_for_high_risk_members

	CREATE NONCLUSTERED INDEX IX_PartyKey ON dbo.tags_for_high_risk_members(PartyKey)
---------------------------------------------------------------------------------------------------------------------------

	DROP INDEX IX_PartyKey ON dbo.tags_for_high_risk_PTB_members

	TRUNCATE TABLE dbo.tags_for_high_risk_PTB_members

	INSERT INTO dbo.tags_for_high_risk_PTB_members(
		PartyKey,
		MemberID,
		MVDID,
		LOB,
		CmOrgRegion,
		PredictionDate,
		ConceptionDate,
		Count_Days_post_Conception,
		Is_Top10pct_predicted,
		Is_recurring,
		Top_k_pct_predicted,
		Is_SUD3_predicted,
		Is_Ortho3_predicted,
		Is_Renal3_predicted,
		Is_Depress3_predicted,
		Med_PaidAmt_Prev360d,
		RX_PaidAmt_Prev360d,
		SDOH_Vulnerable_OverAll,
		SDOH_Vulnerable_Socioeconomic,
		SDOH_Vulnerable_HH_ComposiitonDisability,
		SDOH_Vulnerable_Language,
		SDOH_Vulnerable_Transportation,
		Avg_MME_per_DayOnMME_Prev360d,
		Max_MME_per_DayOnMME_Prev360d,
		Total_MME_Prev360d,
		Family_Size,
		Has_Depressed_Family_Members_in_History,
		Is_Depressed_in_History,
		Has_Obesity_History,
		Latest_Obesity_Dx_in_History,
		Latest_Rx_Fill,
		Latest_Visit_to_Provider,
		Has_Visit_to_Provider_in_Prev120d,
		Latest_Visit_to_ED,
		Count_EDvisits_in_Prev120d,
		GapInCare_CDC_ha1c,
		GapInCare_mammogram,
		GapInCare_MedExam,
		Has_DiabetesMellitus_past720d,
		Count_Dist_Chronic_ICD10dx_in_history,
		Count_Dist_Chronic_CCS_in_history,
		Count_Dist_Chronic_BodySystem_in_history,
		ElixGrp_AA_in_history,
		ElixGrp_BLA_in_history,
		ElixGrp_CA_in_history,
		ElixGrp_CHF_in_history,
		ElixGrp_Coag_in_history,
		ElixGrp_COPD_in_history,
		ElixGrp_DA_in_history,
		ElixGrp_DC_in_history,
		ElixGrp_Depres_in_history,
		ElixGrp_DrgAbuse_in_history,
		ElixGrp_DUC_in_history,
		ElixGrp_FED_in_history,
		ElixGrp_HC_in_history,
		ElixGrp_HIV_in_history,
		ElixGrp_HUC_in_history,
		ElixGrp_Hy_in_history,
		ElixGrp_LD_in_history,
		ElixGrp_Ly_in_history,
		ElixGrp_MC_in_history,
		ElixGrp_OBS_in_history,
		ElixGrp_OND_in_history,
		ElixGrp_Paralysis_in_history,
		ElixGrp_PCD_in_history,
		ElixGrp_Psycs_in_history,
		ElixGrp_PUDExB_in_history,
		ElixGrp_PVD_in_history,
		ElixGrp_RA_in_history,
		ElixGrp_RF_in_history,
		ElixGrp_STM_in_history,
		ElixGrp_VD_in_history,
		ElixGrp_WgtLoss_in_history,
		Has_Chronic_SUD_in_history,
		Model_Used
	)
	SELECT
		PartyKey,
		MemberID,
		MVDID,
		LOB,
		CmOrgRegion,
		PredictionDate,
		ConceptionDate,
		Count_Days_post_Conception,
		Is_Top10pct_predicted,
		Is_recurring,
		Top_k_pct_predicted,
		Is_SUD3_predicted,
		Is_Ortho3_predicted,
		Is_Renal3_predicted,
		Is_Depress3_predicted,
		Med_PaidAmt_Prev360d,
		RX_PaidAmt_Prev360d,
		SDOH_Vulnerable_OverAll,
		SDOH_Vulnerable_Socioeconomic,
		SDOH_Vulnerable_HH_ComposiitonDisability,
		SDOH_Vulnerable_Language,
		SDOH_Vulnerable_Transportation,
		Avg_MME_per_DayOnMME_Prev360d,
		Max_MME_per_DayOnMME_Prev360d,
		Total_MME_Prev360d,
		Family_Size,
		Has_Depressed_Family_Members_in_History,
		Is_Depressed_in_History,
		Has_Obesity_History,
		Latest_Obesity_Dx_in_History,
		Latest_Rx_Fill,
		Latest_Visit_to_Provider,
		Has_Visit_to_Provider_in_Prev120d,
		Latest_Visit_to_ED,
		Count_EDvisits_in_Prev120d,
		GapInCare_CDC_ha1c,
		GapInCare_mammogram,
		GapInCare_MedExam,
		Has_DiabetesMellitus_past720d,
		Count_Dist_Chronic_ICD10dx_in_history,
		Count_Dist_Chronic_CCS_in_history,
		Count_Dist_Chronic_BodySystem_in_history,
		ElixGrp_AA_in_history,
		ElixGrp_BLA_in_history,
		ElixGrp_CA_in_history,
		ElixGrp_CHF_in_history,
		ElixGrp_Coag_in_history,
		ElixGrp_COPD_in_history,
		ElixGrp_DA_in_history,
		ElixGrp_DC_in_history,
		ElixGrp_Depres_in_history,
		ElixGrp_DrgAbuse_in_history,
		ElixGrp_DUC_in_history,
		ElixGrp_FED_in_history,
		ElixGrp_HC_in_history,
		ElixGrp_HIV_in_history,
		ElixGrp_HUC_in_history,
		ElixGrp_Hy_in_history,
		ElixGrp_LD_in_history,
		ElixGrp_Ly_in_history,
		ElixGrp_MC_in_history,
		ElixGrp_OBS_in_history,
		ElixGrp_OND_in_history,
		ElixGrp_Paralysis_in_history,
		ElixGrp_PCD_in_history,
		ElixGrp_Psycs_in_history,
		ElixGrp_PUDExB_in_history,
		ElixGrp_PVD_in_history,
		ElixGrp_RA_in_history,
		ElixGrp_RF_in_history,
		ElixGrp_STM_in_history,
		ElixGrp_VD_in_history,
		ElixGrp_WgtLoss_in_history,
		Has_Chronic_SUD_in_history,
		Model_Used
	FROM [VD-RPT02].Datalogy.ds.tags_for_high_risk_PTB_members

	CREATE NONCLUSTERED INDEX IX_PartyKey ON dbo.tags_for_high_risk_PTB_members(PartyKey)

END